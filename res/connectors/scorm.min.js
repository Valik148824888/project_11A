var a=class{static log(e,...r){console.log(e,...r)}static warn(e,...r){console.warn(e,...r)}static error(e,...r){console.error(e,...r)}static assert(e,r){e||a.error("Assertion failed"+(r?": "+r:""))}};function f(t,e){return a.assert(t,e),t}function u(t){return t!==void 0}function ee(t){let e=typeof t;return e=="object"&&t!=null||e=="function"}function G(t){return typeof t=="function"}function $(t){return t===null}function re(t,e,r){return function(...o){r&&r(...o);let n=t(...o);return e(this,n,...o),n}}var _=Function("return this")(),Ce=()=>!0;function T(t,e){if(!!Ce()){if(e){a.error(t);return}a.warn(t)}}function Q(t,e){let r=t.stack||t.toString();String(r).indexOf(t.message)<0&&T(t.message,e),T(r,e)}var Ee=Object.getPrototypeOf({});function q(t){!t||(f(!t.disposed),!1&&setTimeout(()=>{let e=t.owner?t.owner.constructor.name:null,r=t.owner?t.ownerPropertyName():null;if(t.owner=null,t.ownerPropertyName=null,t instanceof h){let i=e?`[${e}].${r} have active signals`:void 0;f(t.handlersCount()==0,i)}let o=t,n=new Set;for(;(o=f(Object.getPrototypeOf(o)))!=Ee;)Object.getOwnPropertyNames(o).forEach(i=>{i!="constructor"&&n.add(i)});n.forEach(i=>{G(t[i])&&(t[i]=re(t[i].bind(t),()=>{T(`using method ${i} from disposed object ${t.constructor.name}`,!0)}))})},100),G(t.dispose)&&t.dispose(),t.disposed=!0)}function te(t,e){let r=t.split("."),o=_;!(r[0]in o)&&typeof o.execScript!="undefined"&&o.execScript("var "+r[0]);for(let n;r.length&&(n=r.shift());)!r.length&&u(e)?o[n]=e:o[n]&&o[n]!==Object.prototype[n]?o=o[n]:o=o[n]={}}!1||(_.onerror=function(...t){let[e,,,,r]=t;return r?Q(r,!0):T(e,!0),!0});var Le=0,w=class{constructor(e,r,o,n,i=null){this.listener=e,this.src=r,this.type=o,this.capture=!!n,this.handler=i,this.key=++Le}};var I=class extends w{constructor(e,r,o,n,i,s){super(e,o,n,i,s),this.proxy=r,this.callOnce=!1,this.removed=!1}markAsRemoved(){this.removed=!0,this.listener=null,this.proxy=null,this.src=null,this.handler=null}};function oe(t,e,r){for(let o in t)if(e.call(r,t[o],o,t))return!0;return!1}function ne(t,e,r){if(t){for(let o in t)if(e.call(r,t[o],o,t))return o}}function ie(t,e){for(let r in t)if(!(r in e)||t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}function se(t,e,r){let o={};if(t)for(let n in t)e.call(r,t[n],n,t)&&(o[n]=t[n]);return o}var E=class{constructor(e){this.src=e,this.listeners={},this._typeCount=0}getTypeCount(){return this._typeCount}getListenerCount(){let e=0;for(let r of Object.keys(this.listeners))e+=this.listeners[r].length;return e}add(e,r,o,n,i){let s=e.toString(),m=this.listeners[s];m||(m=this.listeners[s]=[],this._typeCount++);let p,c=this._findListenerIndex(m,r,n,i);return c>-1?(p=m[c],o||(p.callOnce=!1)):(p=new I(r,null,this.src,s,!!n,i),p.callOnce=o,m.push(p)),p}remove(e,r,o,n){let i=e.toString();if(!(i in this.listeners))return!1;let s=this.listeners[i],m=this._findListenerIndex(s,r,o,n);return m>-1?(s[m].markAsRemoved(),s.splice(m,1),s.length==0&&(delete this.listeners[i],this._typeCount--),!0):!1}removeByKey(e){let r=e.type;if(!(r in this.listeners))return!1;let o=this.listeners[r],n=o.indexOf(e),i=n>=0;return i&&(o.splice(n,1),e.markAsRemoved(),this.listeners[r].length==0&&(delete this.listeners[r],--this._typeCount)),i}getListeners(e,r){let o=this.listeners[e.toString()],n=[];if(o)for(let i=0;i<o.length;++i){let s=o[i];s.capture==r&&n.push(s)}return n}getListener(e,r,o,n){let i=this.listeners[e.toString()],s=-1;return i&&(s=this._findListenerIndex(i,r,o,n)),s>-1?i[s]:null}hasListener(e="",r){let o=u(e),n=o?e.toString():"",i=u(r);return oe(this.listeners,s=>{for(let m=0;m<s.length;++m)if((!o||s[m].type==n)&&(!i||s[m].capture==r))return!0;return!1})}_findListenerIndex(e,r,o,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.removed&&s.listener==r&&s.capture==!!o&&s.handler==n)return i}return-1}};var Y="ispring_lm_"+(Math.random()*1e6|0),J;function ve(){if(!_.addEventListener||!Object.defineProperty)return!1;let t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});return _.addEventListener("test",Function.prototype,e),_.removeEventListener("test",Function.prototype,e),t}function Ae(){return u(J)||(J=ve()),J}function X(t){let e=t[Y];return e instanceof E?e:null}function y(t){let e=t;if(!e||e.removed)return!1;let r=e.src,o=e.type,n=e.proxy;r.removeEventListener&&r.removeEventListener(o,n,e.capture);let i=X(r);return i?(i.removeByKey(e),i.getTypeCount()==0&&(r[Y]=null)):e.markAsRemoved(),!0}function Te(t){let{listener:e,handler:r,callOnce:o}=t,n=r?e.bind(r):e;return o?(...i)=>{n(...i),y(t)}:n}function L(t,e,r,o,n=null){let i=ee(o)?f(o).capture:!!o,s=X(t);s||(s=new E(t),t[Y]=s);let m=!!(o&&o.once),p=s.add(e,r,m,i,n);if(p.proxy)return p;let c=Te(p);if(p.proxy=c,t.addEventListener){let W=Ae()?o:i;u(W)||(W=!1),t.addEventListener(e.toString(),c,W)}else throw new Error("addEventListener is unavailable.");return p}function pe(t,e,r,o,n){o=!!o;let i=X(t);return i?i.getListener(e,r,o,n):null}var D=class{dispose(){}};var Oe=0,b=class extends D{constructor(){super(),this._listenersKeys=null,this._activeSignals=null,this._disposables=null,this._customDestructHandlers=null}addDestructHandler(e){this._customDestructHandlers=this._customDestructHandlers||[],this._customDestructHandlers.push(e)}dispose(){if(this._destruct(),this._customDestructHandlers)for(let e of this._customDestructHandlers)e();if(this._disposables)for(let e of this._disposables)q(e);if(this._listenersKeys){for(let e of this._listenersKeys)y(e);this._listenersKeys=null}if(this._activeSignals)for(let e of Object.keys(this._activeSignals))this._removeSignalByKey(e)}_listen(e,r,o,n){this._listenersKeys=this._listenersKeys||[];let i=L(this._getEventTarget(e),r,o,n,this);return this._listenersKeys.push(i),i}_unlisten(e,r,o){let n=pe(this._getEventTarget(e),r,o,!1);return!!n&&this._unlistenByKey(n)}_unlistenByKey(e){let r=f(this._listenersKeys),o=r.indexOf(e);return o>=0&&r.splice(o,1),y(e)}_addSignal(e,r,o){this._activeSignals=this._activeSignals||{},e.add(r,this,o);let n=++Oe;return this._activeSignals[n]={dispatcher:e,fn:r,priority:o},n}_addSignalCallOnce(e,r,o){let n=(...i)=>{r.apply(this,i),this._removeSignal(e,n,o)};this._addSignal(e,n,o)}_removeSignal(e,r,o){let n=ne(this._activeSignals,i=>ie(i,{dispatcher:e,fn:r,priority:o}));n?this._removeSignalByKey(n):!1&&a.warn("unknown signal")}_removeSignalByKey(e){if(!(this._activeSignals&&this._activeSignals[e])){a.warn("unknown signal key");return}let{dispatcher:r,fn:o,priority:n}=this._activeSignals[e];r.remove(o,this,n),delete this._activeSignals[e]}_removeAllEvents(e){if(!!e){if(this._activeSignals){let r=se(this._activeSignals,o=>o.dispatcher.eventOwner()==e);for(let o of Object.keys(r))this._removeSignalByKey(o)}if(this._listenersKeys){let r=this._getEventTarget(e),o=this._listenersKeys.filter(n=>n.src==r);for(let n of o)this._unlistenByKey(n)}}}_name(){let e=this,r=e.owner,o=`[${this.constructor.name}]`;return r&&(o+=` in [${r.constructor.name}].${e.ownerPropertyName()}`),o}_addDisposable(e){if(this._disposables=this._disposables||[],!e||this._disposables.includes(e))return e;if(!1){let r=e;f(this._disposables.indexOf(e)<0),f(!r.owner),r.owner=this,r.ownerPropertyName=()=>{let o=this;for(let n of Object.keys(o))if(o[n]==r)return n;return"unknown"}}return this._disposables.push(e),e}_removeDisposable(...e){if(!!this._disposables){for(let r of e)if(r){this._cleanItemDependencies(r);let o=this._disposables.indexOf(r);o>=0&&(this._disposables.splice(o,1),q(r))}}}_cleanItemDependencies(e){this._removeAllEvents(e)}_cleanDependencies(...e){for(let r of e)r&&this._cleanItemDependencies(r)}_getEventTarget(e){return e}_destruct(){}};function we(t,e){return t>e?1:t<e?-1:0}function me(t,e){if(!t)return!1;let r=t.indexOf(e),o=r>=0;return o&&t.splice(r,1),o}function Ie(t,e,r,o,n){let i=0,s=t.length,m;for(;i<s;){let p=i+s>>1,c;r?c=e.call(n,t[p],p,t):c=e(o,t[p]),c>0?i=p+1:(s=p,m=!c)}return m?i:~i}function De(t,e,r=we){return Ie(t,r,!1,e)}function fe(t,e,r){let o=De(t,e,r);return o<0?(t.splice(-(o+1),0,e),!0):!1}var R=class{constructor(){this._priorities=null,this._values=null,this._zeroPriorityValues=null}push(e,r){this._addPriority(r);let o=this._getPriorityValues(r);o?o.push(e):a.warn("Priority array values are zero")}remove(e,r){let o=this._getPriorityValues(r);o&&me(o,e)}removeAt(e,r){let o=this._getPriorityValues(r);o&&o.splice(e,1)}getValuesWithPriority(e){if(e==0)return this._zeroPriorityValues||[];if(!this._values)return a.warn("Priority array values are zero"),[];if(!(e in this._values))return[];let r=this._getPriorityValues(e);return r||(a.warn("Priority array values are zero"),[])}getAllValues(){if(!this._values)return this._zeroPriorityValues?this._zeroPriorityValues.slice():[];let e=[],r=f(this._priorities);for(let o=0;o<r.length;++o){let n=r[o],i=this._getPriorityValues(n);i&&e.push(...i)}return e}_addPriority(e){if(e==0){this._zeroPriorityValues=this._zeroPriorityValues||[];return}this._priorities=this._priorities||[0],this._values=this._values||{},e in this._values||(this._values[e]=[],fe(this._priorities,e))}_getPriorityValues(e){return e==0?this._zeroPriorityValues:f(this._values)[e]}};var h=class extends b{constructor(e=null){super(),this._handlers=null,this._owner=e}eventOwner(){return this._owner}add(e,r,o=0){this._handlers=this._handlers||new R,this._handlers.push({fn:e,context:r},o)}addCallOnce(e,r,o=0){let n=i=>{e.call(r,i),this.remove(n,r,o)};this.add(n,r,o)}remove(e,r,o=0){if(!this._handlers){a.warn("Signal has no handlers!");return}let n=this._handlers.getValuesWithPriority(o),i=n.length;for(let s=0;s<i;++s){let m=n[s];if(m.fn==e&&m.context==r){this._handlers.removeAt(s,o);break}}}has(e,r,o=0){if(!this._handlers)return!1;let n=this._handlers.getValuesWithPriority(o),i=n.length;for(let s=0;s<i;++s){let m=n[s];if(m.fn==e&&m.context==r)return!0}return!1}dispatch(e){if(!this._handlers)return;let r=this._handlers.getAllValues(),o=r.length;for(let n=0;n<o;++n){let i=r[n];if(this._handlers.getAllValues().indexOf(i)!=-1)if(!1)i.fn.apply(i.context,[e]);else try{i.fn.apply(i.context,[e])}catch(s){Q(s,!0)}}}toFn(){return e=>this.dispatch(e)}handlersCount(){return this._handlers?this._handlers.getAllValues().length:0}};function M(t,e,r=!0){if(r)return parseFloat(t.toFixed(e))+"";let o=Math.pow(10,e);return Math.floor(t*o)/o+""}var Z={CLICK:"click",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",CHANGE:"change",SELECTION_CHANGE:"selectionchange",INPUT:"input",TEXT_INPUT:"textInput",KEY_DOWN:"keydown",KEY_PRESS:"keypress",PASTE:"paste",CUT:"cut",COPY:"copy",BLUR:"blur",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",LOAD:"load",LOAD_END:"loadend",LOADED_METADATA:"loadedmetadata",UNLOAD:"unload",BEFOREUNLOAD:"beforeunload",ERROR:"error",DRAG_START:"dragstart",DRAG_OVER:"dragover",DRAG_END:"dragend",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DROP:"drop",RESIZE:"resize",SCROLL:"scroll",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",ORIENTATIONCHANGE:"orientationchange",CUSTOM_CONNECTED:"connected",CUSTOM_DISCONNECTED:"disconnected",TRANSITIONEND:"transitionend",TOUCHSTART:"touchstart",VISIBILITYCHANGE:"visibilitychange"};var U=class{constructor(e){this._options=e}usePassedStatus(e){return!!(this._options&(e?2:1))}};function ce(t){let e=Math.floor(t/3600),r=Math.floor(t%3600/60),o=Math.floor(t%60),n=t-Math.floor(t);return{h:e,m:r,s:o,ms:n}}function j(t){return t<10?"0"+t:t}function V(t){let e=ce(t);return"PT"+e.h+"H"+e.m+"M"+e.s+"S"}function A(t){let e=ce(t);return j(e.h)+":"+j(e.m)+":"+j(e.s)}function v(t){return t<10?"0"+t:t}function le(t){return typeof t=="number"&&(t=new Date(t)),t.getUTCFullYear()+"-"+v(t.getUTCMonth()+1)+"-"+v(t.getUTCDate())+"T"+v(t.getUTCHours())+":"+v(t.getUTCMinutes())+":"+v(t.getUTCSeconds())+".0Z"}function ue(t){let e=document.createElement("a");e.href="goodbye.html",e.click()}function x(){try{window==window.top?(window.open("","_self",""),window.close()):ue(window)}catch{ue(f(window.top))}}function xe(t){return t.trim().replace(/[^\w-]/g,"_")}var Re={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"student_response",result:"result",duration:"latency",visitTime:"time"},Me={id:"id",type:"type",score:"weighting",correctResponse:"correct_responses.%INDEX%.pattern",userResponse:"learner_response",description:"description",result:"result",duration:"latency",visitTime:"timestamp"},Ue={};function de(t){return"cmi.interactions."+t+"."}function he(t){return parseInt(t.getValue("cmi.interactions._count"),10)}function ge(t,e,r,o,n){if(n){let p=t.id+"_"+t.description,c=xe(p.substr(0,255));r.setValue(e+o.id,c)}else r.setValue(e+o.id,t.id);r.setValue(e+o.type,t.type),r.setValue(e+o.score,t.score);let i=t.correctResponses||[];for(let p=0;p<i.length;++p){let c=o.correctResponse.replace("%INDEX%",String(p));r.setValue(e+c,i[p])}let s=t.userResponse;s!=null&&r.setValue(e+o.userResponse,s);function m(p){return n&&p=="incorrect"?"wrong":p}r.setValue(e+o.result,m(t.result))}function _e(t,e){let r=Ue,o=t.id,n=-1;if(t.id in r?n=r[o]:(n=he(e),r[o]=n),n<0)return;let i=de(n),s=Re;ge(t,i,e,s,!0);let m=t.duration;m!=null&&e.setValue(i+s.duration,A(m/1e3));let p=t.visitTime;if(p!=null){let c=p.getHours()*3600+p.getMinutes()*60+p.getSeconds();e.setValue(i+s.visitTime,A(c))}}function ye(t,e){let r=he(e);if(r<0)return;let o=de(r),n=Me;ge(t,o,e,n,!1),e.setValue(o+n.description,t.description);let i=t.duration;i!=null&&e.setValue(o+n.duration,V(i/1e3));let s=t.visitTime;s!=null&&e.setValue(o+n.visitTime,le(s))}var F={NORMAL:"normal",BROWSE:"browse",REVIEW:"review"};function Se(t,e){try{for(let o=0;o<255;++o){if(t[e])return t[e];let n=t.parent;if(!n||t==n)break;t=n}}catch{}return null}function N(t,e){return Se(t,e)||t.opener&&Se(t.opener,e)}var S=class{constructor(e,r){this._api=e,this._passed=!1,this._commitsCount=0,this._suspendEnabled=r}static create(e){let r=N(window,"API");return r?new S(r,e):null}initialize(){try{return this._toBool(this._api.LMSInitialize(""))}catch{}return!1}terminate(e){this.setValue("cmi.core.exit",e?this._getSuspendState():""),this.commit();try{return this._toBool(this._api.LMSFinish(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.core.exit",this._suspendEnabled?this._getSuspendState():"");try{let e=this._toBool(this._api.LMSCommit(""));return this._commitsCount+=1,e}catch{}return!1}setPassed(e){this._passed=e}getValue(e){try{return this._api.LMSGetValue(e)}catch{}return""}setValue(e,r){typeof r=="number"&&(r=M(Number(r),2)+"");try{return this._toBool(this._api.LMSSetValue(e,r))}catch{}return!1}_toBool(e){return e=="true"}};var z=class{constructor(e){this._base=S.create(e),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(e,r){if(this._initialized){e();return}this._base?(this._initialized=this._base.initialize(),this._initialized?e():r()):(this._initialized=!1,r())}terminate(e){return this._base?this._base.terminate(e):!1}commit(){return this._base?this._base.commit():!1}getValue(e){return this._base?this._base.getValue(e):""}setValue(e,r){return this._base?this._base.setValue(e,r):!1}setScore(e,r,o,n){this.setValue("cmi.core.score.raw",e),this.setValue("cmi.core.score.min",r),this.setValue("cmi.core.score.max",o)}setProgress(e){}setSessionTime(e){this.setValue("cmi.core.session_time",A(e/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}getLaunchMode(){return F.NORMAL}setSuspendedData(e){this.setValue("cmi.suspend_data",e)}setStatus(e,r){$(e)?$(r)?this.setValue("cmi.core.lesson_status","unknown"):this.setValue("cmi.core.lesson_status",r?"completed":"incomplete"):this.setValue("cmi.core.lesson_status",e?"passed":"failed")}setPassed(e){f(this._base).setPassed(e)}addInteraction(e){_e(e,this)}getUserInfo(){return{id:this.getValue("cmi.core.student_id"),name:this.getValue("cmi.core.student_name"),email:""}}};var k={SECOND:"2",THIRD:"3",FOURTH:"4"};var P=class{constructor(e,r,o){this._api=e,this._edition=r,this._passed=!1,this._commitsCount=0,this._suspendEnabled=o}static create(e,r){let o=N(window,"API_1484_11");return o?new P(o,e,r):null}initialize(){try{return this._toBool(this._api.Initialize(""))}catch{}return!1}terminate(e){this.setValue("cmi.exit",e?this._getSuspendState():"normal"),this.setValue("adl.nav.request","exitAll"),this.commit();try{return this._toBool(this._api.Terminate(""))}catch{}return!1}_getSuspendState(){return this._passed?"":"suspend"}commit(){this._commitsCount==0&&this.setValue("cmi.exit",this._suspendEnabled?this._getSuspendState():"normal");try{let e=this._toBool(this._api.Commit(""));return this._commitsCount+=1,e}catch{}return!1}getValue(e){try{return this._api.GetValue(e)}catch{}return""}setValue(e,r){typeof r=="number"&&(r=M(r,7));try{return this._toBool(this._api.SetValue(e,r))}catch{}return!1}setPassed(e){this._passed=e}getSuspendDataLimit(){return this._edition==k.SECOND?4e3:64e3}_toBool(e){return e=="true"}};var B=class{constructor(e,r){this._base=P.create(e,r),this._initialized=!1}initialize(){return this._initialized?!0:(this._initialized=this._base?this._base.initialize():!1,this._initialized)}initializeAsync(e,r){if(this._initialized){e();return}this._base?(this._initialized=this._base.initialize(),this._initialized?e():r()):(this._initialized=!1,r())}terminate(e){return this._base?this._base.terminate(e):!1}commit(){return this._base?this._base.commit():!1}getValue(e){return this._base?this._base.getValue(e):""}setValue(e,r){return this._base?this._base.setValue(e,r):!1}setScore(e,r,o,n=0){this.setValue("cmi.score.raw",e),this.setValue("cmi.score.min",r),this.setValue("cmi.score.max",o),this.setValue("cmi.score.scaled",n)}setProgress(e){this.setValue("cmi.progress_measure",e)}setSessionTime(e){this.setValue("cmi.session_time",V(e/1e3))}getSuspendedData(){return this.getValue("cmi.suspend_data")}setSuspendedData(e){if(!this._base)throw new Error;let r=this._base.getSuspendDataLimit();e.length<=r&&this.setValue("cmi.suspend_data",e)}getLaunchMode(){return this._base?this._base.getValue("cmi.mode"):F.NORMAL}setStatus(e,r){let o=(n,i,s,m)=>n===null?i:n?s:m;this.setValue("cmi.success_status",o(e,"unknown","passed","failed")),this.setValue("cmi.completion_status",o(r,"unknown","completed","incomplete"))}setPassed(e){this._base&&this._base.setPassed(e)}addInteraction(e){ye(e,this)}getUserInfo(){return{id:this.getValue("cmi.learner_id"),name:this.getValue("cmi.learner_name"),email:""}}};function Pe(){return{onSessionStart:new h,onSessionEnd:new h}}var d=class{constructor(e,r){this._apiVersion=e,this._config=r,this._active=!1,this._playerApi=null,this._suspendEnabled=!0,this._startTime=0,this._lmsApi=null,this._closeEventKeys=[],this._progress=[],this._sessionStateNotifier=Pe()}initializeLms(e){try{let r=new U(this._config.flags);this._lmsApi=this._createLmsApi(this._apiVersion,r,this._suspendEnabled)}catch(r){a.error(r),this._onLmsApiInitializationFailed(e)}this._lmsApi&&this._lmsApi.initialize(this._onLmsApiInitialized.bind(this,e),this._onLmsApiInitializationFailed.bind(this,e))}_createLmsApi(e,r,o){}_onLmsApiInitialized(e){let o=f(this._lmsApi).getSuspendData();e(o||void 0).then(i=>this._start(i)),this._closeEventKeys=[L(window,Z.UNLOAD,()=>this._closeLms()),L(window,Z.BEFOREUNLOAD,()=>this._closeLms())]}_onLmsApiInitializationFailed(e){a.error("Lms initialization failed"),e().then(()=>{})}_start(e){this._playerApi=e,this._active=!0,this._startTime=Date.now(),this._sessionStateNotifier.onSessionStart.dispatch(e.getTitle()),e.onClosePlayerRequest.add(()=>{this._closeLms(),x()}),this._progress=e.getCurrentSectionsStateProgress(),e.onSelectedSectionChange.add(()=>this._updatePersistedState()),e.onSectionProgressChange.add(()=>{let r=e.getCurrentSectionIndex();r>=0&&!this._progress[r]&&e.getCurrentSectionProgress()>=1&&(f(this._lmsApi).setItemViewed(r),this._progress[r]=!0,this._updateUserProgress())}),this._updateUserProgress()}_createIri(){return`ispring://roll/${encodeURIComponent(this._config.contentId)}`}_closeLms(){if(this._closeEventKeys)for(let r of this._closeEventKeys)y(r);this._active&&(this._active=!1,this._updateDuration(),this._updateUserProgressOnClose()),this._sessionStateNotifier.onSessionEnd.dispatch();let e=f(this._lmsApi);this._suspendEnabled?e.suspend():e.terminate()}_updateUserProgressOnClose(){}_updateUserProgress(){let e=this._progress.filter(o=>o).length,r=f(this._lmsApi);r.setProgress(e/this._progress.length),r.setStatus(null,e>=this._config.chaptersCount),r.commit()}_updateDuration(){let e=Date.now()-this._startTime;f(this._lmsApi).setLessonDuration(e)}_updatePersistedState(){this._suspendEnabled&&this._playerApi&&this._lmsApi&&this._lmsApi.setSuspendData(this._playerApi.getSuspendData())}};var C=class{constructor(){this._connector=null}createConnector(){}getLearnerPreferences(){return null}initialize(e,r){this._connector=this.createConnector(),this._connector?this._connector.initializeAsync(e,r):r()}commit(){this._getConnector().commit()}suspend(){this._getConnector().terminate(!0),x()}terminate(){this._getConnector().terminate(!1),x()}setSuspendData(e){this._getConnector().setSuspendedData(e)}getSuspendData(){return this._getConnector().getSuspendedData()}setStatus(e,r){this._getConnector().setStatus(e,r)}setScore(e,r,o,n){let i=o-r>0?e/(o-r):0;n!=null&&(e=i*n,o=n),this._getConnector().setScore(e,r,o,i)}setItemViewed(e){}setProgress(e){this._getConnector().setProgress(e)}setLessonDuration(e){this._getConnector().setSessionTime(e)}getUserInfo(){return this._getConnector().getUserInfo()}_getConnector(){if(!this._connector)throw new Error("Connector not created");return this._connector}};var H=class extends C{constructor(e,r){super(),this._reportOptions=e,this._suspendEnabled=r}createConnector(){return new z(this._suspendEnabled)}setStatus(e,r){this._getConnector().setStatus(null,r)}suspend(){super.suspend(),x()}terminate(){super.terminate(),x()}};var K=class extends C{constructor(e,r=k.SECOND){super(),this._edition=r,this._suspendEnabled=e}createConnector(){return new B(this._edition,this._suspendEnabled)}};function Ve(t){return{apiVersion:t.apiVersion,flags:t.flags,contentId:t.contentId,chaptersCount:t.chaptersCount,edition:t.edition}}var g=class extends d{constructor(e){super(e.apiVersion,e),this._scormConfig=e}static create(e){return new g(Ve(e))}_createLmsApi(e,r,o){switch(e){case"scorm12":return new H(r,o);case"scorm2004":return new K(o,this._scormConfig.edition)}throw new Error("unknown api version")}};te("iSpring.roll.LMS.create",g.create);d.prototype.initialize=d.prototype.initializeLms;
